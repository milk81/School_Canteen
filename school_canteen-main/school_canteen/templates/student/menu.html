{% extends "base.html" %}

{% block title %}Меню - Школьная столовая{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1>Меню школьной столовой</h1>
        <p class="text-muted">Выберите дату и тип питания для просмотра меню</p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form method="GET" action="{{ url_for('student.menu') }}" class="row g-3">
            <div class="col-md-4">
                <label for="date" class="form-label">Дата</label>
                <input type="date" class="form-control" id="date" name="date" value="{{ selected_date }}">
            </div>
            <div class="col-md-4">
                <label for="type" class="form-label">Тип питания</label>
                <select class="form-select" id="type" name="type">
                    <option value="all" {% if meal_type == 'all' %}selected{% endif %}>Все</option>
                    <option value="breakfast" {% if meal_type == 'breakfast' %}selected{% endif %}>Завтрак</option>
                    <option value="lunch" {% if meal_type == 'lunch' %}selected{% endif %}>Обед</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Показать</button>
            </div>
        </form>
    </div>
</div>

{% if menu_items %}
    <div class="row">
        <div class="col-md-12">
            <h4>Меню на {{ selected_date }}</h4>
        </div>
    </div>

    <div class="row">
        {% for item in menu_items %}
        <div class="col-md-6 mb-4">
            <div class="menu-item {% if item.type == 'breakfast' %}breakfast{% else %}lunch{% endif %}">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5>{{ item.name }}</h5>
                    <span class="badge {% if item.type == 'breakfast' %}bg-success{% else %}bg-danger{% endif %}">
                        {% if item.type == 'breakfast' %}Завтрак{% else %}Обед{% endif %}
                    </span>
                </div>

                <p class="text-muted mb-3">{{ item.description or "Блюдо дня" }}</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-2">
                            <span class="fw-bold">Цена: </span>
                            <span class="text-success fw-bold">{{ item.price }} ₽</span>
                        </div>

                        {% if item.calories %}
                        <div class="mb-2">
                            <span class="fw-bold">Калории: </span>
                            <span>{{ item.calories }} ккал</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="col-md-6">
                        {% if item.allergens %}
                        <div class="mb-2">
                            <span class="fw-bold">Аллергены: </span>
                            <span class="text-danger">{{ item.allergens|join(', ') }}</span>
                        </div>
                        {% endif %}

                        {% if item.contains %}
                        <div class="mb-2">
                            <span class="fw-bold">Содержит: </span>
                            <span>{{ item.contains|join(', ') }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if item.available %}
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-success" disabled>Доступно для заказа</button>
                    </div>
                {% else %}
                    <div class="mt-3">
                        <span class="badge bg-secondary">Недоступно</span>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-5">
        <h4 class="text-muted">На выбранную дату меню не найдено</h4>
        <p>Попробуйте выбрать другую дату или обратитесь к администратору</p>
        <a href="{{ url_for('student.dashboard') }}" class="btn btn-primary mt-3">Вернуться на главную</a>
    </div>
{% endif %}

<div class="row mt-4">
    <div class="col-md-12">
        <div class="alert alert-info">
            <h6>Информация об аллергенах:</h6>
            <ul class="mb-0">
                <li><span class="text-danger">Арахис</span> - может вызывать сильные аллергические реакции</li>
                <li><span class="text-danger">Молоко</span> - лактозная непереносимость</li>
                <li><span class="text-danger">Глютен</span> - содержится в пшенице, ржи, ячмене</li>
                <li><span class="text-danger">Рыба/Морепродукты</span> - аллергия на морепродукты</li>
            </ul>
        </div>
    </div>
</div>

{% for item in breakfast_items %}
<div class="col-md-6 mb-4">
    <div class="menu-item breakfast">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h5 class="mb-1">{{ item.name }}</h5>
                <p class="text-muted small mb-0">{{ item.description }}</p>
            </div>
            <span class="badge bg-success">Завтрак</span>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="mb-2">
                    <span class="fw-bold">Цена: </span>
                    <span class="text-success fw-bold">{{ item.price }} ₽</span>
                </div>

                {% if item.calories %}
                <div class="mb-2">
                    <span class="fw-bold">Калории: </span>
                    <span>{{ item.calories }} ккал</span>
                </div>
                {% endif %}
            </div>

            <div class="col-md-6">
                {% if item.allergens %}
                <div class="mb-2">
                    <span class="fw-bold">Аллергены: </span>
                    <div class="mt-1">
                        {% for allergen in item.allergens %}
                            <span class="badge bg-danger me-1 mb-1">{{ allergen }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="d-flex gap-2">
            {% if item.id in ordered_items %}
                <button class="btn btn-success btn-sm" disabled>
                    <i class="fas fa-check me-1"></i> Заказано
                </button>
            {% else %}
                <a href="{{ url_for('student.order_meal', menu_item_id=item.id) }}"
                   class="btn btn-primary btn-sm">
                    <i class="fas fa-shopping-cart me-1"></i> Заказать
                </a>
            {% endif %}

            {% if item.id in ordered_items %}
                <a href="{{ url_for('student.review', menu_item_id=item.id) }}"
                   class="btn btn-outline-warning btn-sm">
                    <i class="fas fa-star me-1"></i> Оставить отзыв
                </a>
            {% else %}
                <button class="btn btn-outline-secondary btn-sm" disabled>
                    <i class="fas fa-star me-1"></i> Закажите, чтобы оценить
                </button>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}

<!-- Для каждого блюда добавим действия -->
<!-- В цикле для каждого блюда обновим -->