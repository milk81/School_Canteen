{% extends "base.html" %}

{% block title %}–û—Ç—á–µ—Ç—ã - –®–∫–æ–ª—å–Ω–∞—è —Å—Ç–æ–ª–æ–≤–∞—è{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1>–û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
        <p class="text-muted">–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º</p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤</h5>
    </div>
    <div class="card-body">
        <form method="GET" action="{{ url_for('admin.reports') }}" class="row g-3">
            <div class="col-md-3">
                <label for="report_type" class="form-label">–¢–∏–ø –æ—Ç—á–µ—Ç–∞</label>
                <select class="form-select" id="report_type" name="report_type">
                    <option value="attendance">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</option>
                    <option value="financial">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π</option>
                    <option value="nutrition">–ü–∏—Ç–∞–Ω–∏–µ</option>
                    <option value="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="start_date" class="form-label">–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞</label>
                <input type="date" class="form-control" id="start_date" name="start_date">
            </div>
            <div class="col-md-3">
                <label for="end_date" class="form-label">–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞</label>
                <input type="date" class="form-control" id="end_date" name="end_date">
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <div class="d-grid gap-2 w-100">
                    <button type="submit" class="btn btn-primary">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h5>
            </div>
            <div class="card-body">
                {% if attendance_by_day %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–ó–∞–≤—Ç—Ä–∞–∫–∏</th>
                                    <th>–û–±–µ–¥—ã</th>
                                    <th>–í—Å–µ–≥–æ</th>
                                    <th>% –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for date, count in attendance_by_day %}
                                <tr>
                                    <td>{{ date }}</td>
                                    <td>15</td>
                                    <td>25</td>
                                    <td>{{ count }}</td>
                                    <td>
                                        {% set percentage = (count / 100 * 100)|int %}
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar {% if percentage > 80 %}bg-success{% elif percentage > 50 %}bg-warning{% else %}bg-danger{% endif %}"
                                                 style="width: {{ percentage }}%">
                                                {{ percentage }}%
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <h6>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h6>
                            <ul class="list-inline">
                                <li class="list-inline-item">
                                    <span class="badge bg-primary">–í—Å–µ–≥–æ –ø–∏—Ç–∞–Ω–∏–π: {{ total_orders }}</span>
                                </li>
                                <li class="list-inline-item">
                                    <span class="badge bg-success">–°—Ä–µ–¥–Ω—è—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å: 75%</span>
                                </li>
                                <li class="list-inline-item">
                                    <span class="badge bg-info">–ü–∏–∫ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏: –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                {% else %}
                    <p class="text-muted">–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                {% endif %}
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –ø–æ –∫–ª–∞—Å—Å–∞–º</h5>
            </div>
            <div class="card-body">
                {% if class_attendance %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>–ö–ª–∞—Å—Å</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–µ–Ω–∏–∫–æ–≤</th>
                                    <th>–ü–æ—Å–µ—â–µ–Ω–∏–π</th>
                                    <th>% –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</th>
                                    <th>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for class_name, count in class_attendance %}
                                <tr>
                                    <td><strong>{{ class_name }}</strong></td>
                                    <td>25</td>
                                    <td>{{ count }}</td>
                                    <td>
                                        {% set percentage = (count / 25 * 100)|int %}
                                        <span class="badge {% if percentage > 80 %}bg-success{% elif percentage > 50 %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ percentage }}%
                                        </span>
                                    </td>
                                    <td>150 ‚ÇΩ</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª–∞—Å—Å–∞–º</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">–°–≤–æ–¥–∫–∞ –æ—Ç—á–µ—Ç–∞</h5>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <h6>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–û–±—â–∏–π –¥–æ—Ö–æ–¥</span>
                            <span class="text-success">45,800 ‚ÇΩ</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã</span>
                            <span class="text-danger">28,500 ‚ÇΩ</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞</span>
                            <span class="text-danger">12,000 ‚ÇΩ</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</span>
                            <span class="text-primary">5,300 ‚ÇΩ</span>
                        </li>
                    </ul>
                </div>

                <div class="mb-4">
                    <h6>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –±–ª—é–¥:</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ö—É—Ä–∏–Ω—ã–π —Å—É–ø</span>
                            <span class="badge bg-primary">85%</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ì—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞</span>
                            <span class="badge bg-primary">78%</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ö–æ—Ç–ª–µ—Ç–∞ —Å –ø—é—Ä–µ</span>
                            <span class="badge bg-primary">92%</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>–ö–æ–º–ø–æ—Ç</span>
                            <span class="badge bg-primary">65%</span>
                        </li>
                    </ul>
                </div>

                <div class="mb-4">
                    <h6>–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞:</h6>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-success" onclick="exportPDF()">
                            üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
                        </button>
                        <button class="btn btn-outline-primary" onclick="exportExcel()">
                            üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                        </button>
                        <button class="btn btn-outline-secondary" onclick="printReport()">
                            üñ®Ô∏è –ü–µ—á–∞—Ç—å –æ—Ç—á–µ—Ç–∞
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6>–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞:</h6>
                    <ul class="mb-0">
                        <li>–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π –∫—É—Ä–∏–Ω–æ–≥–æ —Å—É–ø–∞</li>
                        <li>–°–Ω–∏–∑–∏—Ç—å –∑–∞–∫—É–ø–∫—É –Ω–µ–ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤</li>
                        <li>–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–∫—Ü–∏—é –¥–ª—è 10–ë –∫–ª–∞—Å—Å–∞ (–Ω–∏–∑–∫–∞—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å)</li>
                        <li>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã —Å—Ç–æ–ª–æ–≤–æ–π</li>
                    </ul>
                </div>
                <div class="text-center">
                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–∞–Ω–µ–ª—å</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function exportPDF() {
    alert('PDF –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω. –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
}

function exportExcel() {
    alert('Excel —Ñ–∞–π–ª –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∏ –∑–∞–≥—Ä—É–∂–µ–Ω. –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
}

function printReport() {
    window.print();
}
</script>

<style>
@media print {
    .navbar, .card-header button, .btn {
        display: none !important;
    }

    .card {
        border: 1px solid #ddd !important;
        box-shadow: none !important;
    }
}
</style>
{% endblock %}